<!--
Sync Impact Report (v2.2.0 → v2.3.0 - Payment Logic Correction and Business Model Refinement)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Version: 2.2.0 → 2.3.0 (MAJOR: 核心业务逻辑修正，支付流程简化，钱包系统重构)
Ratification Date: 2025-10-25
Last Amended: 2025-10-27

Modified Principles:
  ✏️ Principle 5: 修正MVP-3、MVP-4、MVP-5核心业务逻辑，确保与实际需求一致
  ✏️ 删除错误的订单超时机制和动态定价功能
  ✏️ 添加钱包欠费支持和预警催缴机制

Critical Corrections:
  ✅ MVP-3: 支付集成 - 简化为立即支付流程，体验课固定200元，删除待支付状态
  ✅ MVP-4: 钱包系统 - 支持欠费（负余额），预约时立即扣费，添加预警催缴
  ✅ MVP-5: 运营后台 - 完善钱包调整表单字段，添加体验课跟进管理

Updated Business Rules:
  - 体验课支付：立即支付模式，无订单超时，支付失败立即释放名额
  - 体验课价格：固定200元，不支持动态定价
  - 重复预约限制：每个微信OpenID只能预约一次体验课
  - 正式课扣费：预约时立即扣费200元，允许欠费（余额可为负数）
  - 欠费管理：欠费用户限制新预约，支持余额预警（<200元）和催缴通知
  - 运营调整：包含调整原因、收款方式、订单号等完整字段

Rationale:
  1. 业务流程简化：消除复杂的待支付状态管理，实现真正的立即支付
  2. 用户体验优化：支付失败立即释放名额，避免资源浪费
  3. 运营效率提升：支持欠费机制，减少因余额不足导致的预约失败
  4. 风险控制：通过预警催缴机制降低坏账风险
  5. 数据完整性：详细的运营调整记录确保财务审计可追溯

Updated MVP Dependencies:
  - MVP-3: 支付集成（依赖MVP-2A，简化为立即支付流程）
  - MVP-4: 钱包系统（依赖MVP-3，支持欠费和自动扣费）
  - MVP-5: 运营管理后台（依赖MVP-3/4，提供完整的欠费管理功能）

Templates Requiring Updates:
  ⚠️ /templates/spec-template.md - 需更新支付和钱包管理策略说明
  ⚠️ /templates/plan-template.md - 需反映修正后的MVP业务逻辑
  ⚠️ /templates/tasks-template.md - 需适应新的支付和扣费流程

Follow-up TODOs:
  - 完成MVP-3/4/5规格文档修正
  - 更新开发计划以反映新的业务逻辑
  - 调整技术架构设计以支持欠费机制
-->

# 百适体操馆小程序项目宪法

**Project Constitution for CCMartMeet Gymnastics Management System**

---

## 元数据 (Metadata)

| 字段 | 值 |
|------|-----|
| **项目名称** | 百适体操馆运营管理系统 (CCMartMeet) |
| **宪法版本** | 2.3.0 |
| **批准日期** | 2025-10-25 |
| **最后修订** | 2025-10-27 |
| **适用范围** | 小程序前端、Web后台、后端服务、数据库设计 |
| **核心价值** | 简单易用、数据准确、易于维护、分阶段交付 |

---

## 序言 (Preamble)

本宪法为百适体操馆运营管理系统的开发提供**不可妥协的工程原则**。鉴于：

1. **团队规模**：单人产品经理主导，依赖AI Coding工具实现开发
2. **业务复杂度**：涉及多用户管理、排课约课、钱包交易、飞书数据集成
3. **技术背景**：从Serverless架构重构为传统客户端-服务器架构
4. **开发模式**：分阶段迭代上线，无严格deadline，强调长期可维护性
5. **运营优先**：以运营效率为优先，避免过度安全设计增加成本

本宪法建立**九大核心原则**，确保代码质量、系统稳定性和开发效率的平衡。

---

## 核心原则 (Core Principles)

### Principle 1: Simplicity First（简化优先 - AI驱动开发适配）

**原则声明**：
- 所有技术选型必须优先考虑AI Coding工具的熟悉度和代码生成质量
- 避免过度工程化，禁止引入"可能用到"的抽象层
- 每个功能模块必须能在不依赖外部文档的情况下，通过代码注释理解其用途

**技术栈选型（已调研确认）**：

| 层级 | 技术 | 版本 | 选择理由 |
|------|------|------|---------|
| **小程序** | 微信原生框架(MINA) | 基础库 3.11.0+ | AI Coding支持度最高，官方文档完善 |
| **渲染引擎** | Skyline（可选启用） | 基础库 3.0.0+ | 性能提升，按需在特定页面启用 |
| **后台前端** | Vue 3 + Element Plus | 3.x | 成熟UI组件库，开发效率高 |
| **后端** | Python FastAPI | 0.100+ | 异步高性能，AI Coding友好 |
| **数据库** | MySQL | 8.0+ | 关系型数据库，支持ACID事务 |
| **ORM** | SQLAlchemy | 2.x | Python标准ORM工具 |
| **认证** | JWT + 微信OpenID | - | 双重身份验证 |
| **支付** | 微信支付API | v3 | 官方SDK（wechatpayv3） |
| **集成** | 飞书开放平台API | - | 数据导入/同步 |
| **部署** | Docker + Nginx | - | 容器化部署 |

**Skyline启用策略**：
- **启用页面**：首页、课程列表、预约日历等高频交互页面
- **保持WebView**：设置页面、表单页面等简单静态页面
- **配置方式**：在页面`.json`文件添加：
  ```json
  {
    "renderer": "skyline",
    "componentFramework": "glass-easel"
  }
  ```

**具体要求**：
- **MUST**: 使用上述技术栈，不得引入未列出的框架
- **MUST**: 每个函数/方法添加中文注释说明输入输出和业务逻辑
- **MUST**: 避免自定义DSL、元编程、过度抽象的设计模式
- **SHOULD**: 优先使用框架内置功能，而非第三方库
- **MUST NOT**: 引入需要专业DevOps知识才能部署的技术栈

**合规检查**：
- 每个技术选型决策需回答："AI Coding工具能否生成高质量代码？"
- Plan阶段必须评估"代码可读性"和"AI生成友好度"

---

### Principle 2: Data Integrity Above All（数据完整性至上）

**原则声明**：
- 金额、排课、约课、消课数据必须保证强一致性，零容忍数据错误
- 所有涉及钱包扣款、课程预约的操作必须使用数据库事务
- 关键业务逻辑必须有数据审计日志

**具体要求**：
- **MUST**: 使用MySQL的ACID事务保护所有金额变更
- **MUST**: 钱包扣款/充值操作必须记录到`wallet_transaction`表
- **MUST**: 课程预约/取消操作必须记录到`booking_audit_log`表
- **MUST**: 实现乐观锁机制防止超售（课程名额、库存锁定）
- **MUST**: 关键表字段使用`NOT NULL`约束和合理的默认值
- **MUST**: 每日增量备份数据库（建议使用自动化脚本）

**合规检查**：
- Plan阶段必须明确标注哪些操作需要事务保护
- Tasks阶段必须包含"数据一致性测试"任务
- 涉及金额的功能必须通过双人核验（产品+技术朋友审查）

---

### Principle 3: Maintainability & Readability（可维护性与可读性）

**原则声明**：
- 代码必须能让"3个月后的自己"或"技术朋友"快速理解
- 项目结构必须清晰分层，避免"意大利面条式"依赖

**具体要求**：
- **MUST**: 后端遵循MVC分层架构（Model、Service、Controller）
- **MUST**: 前端组件遵循单一职责原则（一个组件只做一件事）
- **MUST**: 文件命名使用语义化命名（如`booking_service.py`、`WalletCard.vue`）
- **MUST**: 关键业务逻辑提取为独立函数，避免超过50行的函数体
- **SHOULD**: 使用类型提示（Python Type Hints、Vue3 TypeScript）
- **MUST**: Git提交信息遵循约定式提交（Conventional Commits）

**合规检查**：
- Code Review时检查函数长度和复杂度
- 每个功能模块必须有README说明其职责

---

### Principle 4: API-First Architecture（API优先架构）

**原则声明**：
- 前后端通过RESTful API解耦，支持未来多端扩展
- 所有外部集成（飞书、微信支付）通过统一API层封装

**具体要求**：
- **MUST**: 后端API遵循RESTful规范（GET/POST/PUT/DELETE语义正确）
- **MUST**: API响应使用统一格式：
  ```json
  {
    "code": 200,
    "message": "操作成功",
    "data": {}
  }
  ```
- **MUST**: 所有API端点必须有版本前缀（如`/api/v1/bookings`）
- **MUST**: 敏感操作（支付回调）必须验证签名
- **SHOULD**: 使用Swagger/OpenAPI自动生成API文档
- **MUST**: 飞书数据导入通过独立的`/api/v1/feishu/import`端点

**合规检查**：
- Plan阶段必须定义完整API契约（路径、参数、响应格式）
- 每个API端点必须有对应的集成测试

---

### Principle 5: Incremental Delivery（增量交付 - 纵向切片策略）

**原则声明**：
- 采用**Vertical Slice（纵向切片）**架构，每个MVP完成一个端到端的完整功能
- 每个切片必须包含：数据库表 + 后端API + 前端页面（小程序或Web后台）
- 优先交付小程序端功能，Web后台延后开发

**MVP阶段划分（超细颗粒度）**：

#### MVP-1：用户身份系统（1-2周）⭐⭐⭐⭐⭐
**交付物**：
- 数据库：`user`、`student`、`user_student_relation`表
- 后端：登录API（`/api/v1/auth/login`）、学员CRUD API（`/api/v1/students`）
- 小程序：登录页、学员管理页、切换学员组件
- Web后台：**暂不开发**

**验收标准**：
- ✅ 微信授权登录成功，获取用户OpenID
- ✅ 家长可创建多个学员档案（姓名、年龄、头像）
- ✅ 切换学员时页面顶部显示当前学员名称和头像
- ✅ 切换学员后弹出确认提示："当前操作学员：XXX"

---

#### MVP-2A：课程显示与基础预约（2-3周）⭐⭐⭐⭐⭐
**交付物**：
- 数据库：`course`、`booking`、`makeup_record`表
- 后端：课程查询API（`/api/v1/courses`）、预约API（`/api/v1/bookings`）
- 小程序：4个Tab页面（首页/预约/课程/我的）、课程列表页、详情页、预约弹窗
- Web后台：**课程管理页面**（首次开发后台功能，CRUD课程）

**验收标准**：
- ✅ 4个Tab页面完整交互流程（首页/预约/课程/我的）
- ✅ 预约Tab按当前档案年龄自动筛选本周课程
- ✅ 固定班独立入口，支持3个月学期预约
- ✅ 体验课按微信OpenID限制（每个微信号仅一次）
- ✅ 灵活排课可取消（开课前6小时），固定班可请假（开课前6小时，生成待补课记录）
- ✅ 预约时检查年龄匹配、时间冲突、库存锁定（使用乐观锁防止超售）
- ✅ 支持已开课但未满员课程的插班申请功能

---

#### MVP-2B：候补与补课管理（1-2周）⭐⭐⭐⭐
**交付物**：
- 数据库：`waitlist`、`waitlist_notification`、`makeup_class`表
- 后端：候补队列API（`/api/v1/waitlist`）、微信服务消息API、补课管理API
- 小程序：候补按钮、候补状态页面、待补课Tab
- Web后台：**候补管理页面**

**验收标准**：
- ✅ 课程满员时显示"加入候补"按钮，支持最多8人候补队列
- ✅ 按FIFO原则管理候补队列，名额锁定以确认时间为准
- ✅ 取消预约/请假后10秒内通知所有候补用户
- ✅ 通过微信服务消息发送候补通知（需申请微信模板消息权限）
- ✅ 请假成功后生成"待补课"记录，无有效期限制
- ✅ 支持符合条件课程的补课预约（同等级+同类型+未满员）

---

#### MVP-2C：私教系统（1-2周）⭐⭐⭐
**交付物**：
- 数据库：`instructor`、`private_class`、`private_booking`表
- 后端：教练管理API（`/api/v1/instructors`）、私教预约API（`/api/v1/private-bookings`）
- 小程序：私教课入口、教练列表页、教练详情页、私教预约页面
- Web后台：**教练管理页面**

**验收标准**：
- ✅ 支持按教练或按时间浏览私教课程
- ✅ 显示教练完整信息（照片/姓名/等级/擅长/介绍/授课时长）
- ✅ 支持灵活的私教课程定价（后台为每节课单独设价）
- ✅ 验证私教课的时间冲突（同一档案不能在同一时间预约多节课）
- ✅ 支持私教课取消预约（规则与团课相同：开课前6小时）
- ✅ 预约成功后该时间段自动标记为"不可选"

---

#### MVP-3：支付集成（1-2周）⭐⭐⭐⭐
**交付物**：
- 数据库：`payment_order`表
- 后端：支付发起API（`/api/v1/payments/create`）、回调API（`/api/v1/payments/callback`）
- 小程序：集成`wx.requestPayment`，固定价格展示
- Web后台：**暂不开发**

**验收标准**：
- ✅ 体验课预约立即吊起微信支付，固定价格200元/节
- ✅ 支付成功后创建预约记录，自动锁定课程名额
- ✅ 支付失败立即释放名额，其他用户可预约
- ✅ 限制每个微信OpenID只能预约一次体验课
- ✅ 支付回调使用官方SDK验证签名（wechatpayv3）
- ✅ 检查订单是否已处理（防止重复回调）
- ✅ 无订单超时机制，简化支付流程

---

#### MVP-4：钱包系统（2-3周）⭐⭐⭐⭐
**交付物**：
- 数据库：`wallet`、`wallet_transaction`、`balance_alert`、`arrears_reminder`表
- 后端：余额查询API（`/api/v1/wallet/my`）、调整API（`/api/v1/admin/wallets/adjust`）
- 小程序：钱包页面、交易记录页
- Web后台：**钱包调整页面**（运营手动调整，包含完整表单字段）

**验收标准**：
- ✅ 支持钱包欠费（余额可为负数），允许余额不足时预约课程
- ✅ 预约正式课时立即扣费200元，取消预约时自动恢复余额
- ✅ 欠费用户限制新预约，弹窗提示"您有欠费，请先充值"
- ✅ 余额低于200元时推送微信预警通知
- ✅ 欠费时推送多场景催缴通知（欠费发生、尝试预约、开课前提醒）
- ✅ 运营调整余额需填写完整信息（调整原因、收款方式、订单号等）
- ✅ 每笔交易记录详细，包含操作人、时间、金额、原因等完整信息

---

#### MVP-5：运营管理后台（2-3周）⭐⭐⭐
**交付物**：
- Web后台：管理员登录、用户管理、钱包管理、课程管理、数据统计
- 钱包调整：完整的调整表单（金额、原因、收款方式、订单号、备注）
- 体验课续课跟进：已完成体验课用户的续课意向跟进管理
- 出勤管理：教练标记学员出勤状态（已到课/缺勤/请假），不涉及扣费
- 数据分析：用户统计、预约统计、收入统计、出勤率统计
- 操作审计：完整的操作日志记录和权限控制
- 小程序：**暂不开发新功能**

**验收标准**：
- ✅ 管理员登录和权限管理（管理员/运营人员/教练/财务角色）
- ✅ 用户信息查看和档案管理，欠费用户标红显示"催缴"按钮
- ✅ 钱包余额调整功能，必须填写调整原因、收款方式等完整字段
- ✅ 系统提示"请将收款流水截图发送至飞书群"
- ✅ 体验课续课跟进管理，基于已完成体验课的用户（红色高亮）
- ✅ 教练可标记学员出勤状态，仅用于统计不涉及扣费
- ✅ 数据看板显示关键指标（用户数、预约数、收入、出勤率）
- ✅ 支持Excel报表导出，数据每5分钟自动刷新
- ✅ 操作日志记录所有敏感操作，支持审计追踪
- ✅ 简化付费记录逻辑：预约时扣费，取消时微信退款，消课只记录出勤

---

**关键原则**：
- **MUST**: 每个MVP必须能独立演示完整业务流程
- **MUST**: 数据库表按需设计，避免过度设计
- **MUST**: 后端API先写测试用例再实现（TDD）
- **SHOULD**: Web后台功能延后至MVP-2及以后
- **MUST NOT**: 在前一个MVP未完成前开始下一个MVP

---

### Principle 6: User-Centric Design（以用户为中心）

**原则声明**：
- 设计决策优先考虑目标用户（家长、教练、管理员）的实际使用场景
- 防呆设计优于事后提醒

**具体要求**：
- **MUST**: 关键操作必须有二次确认（如切换学员身份后的预约确认）
- **MUST**: 错误提示必须清晰说明原因和解决方案（不要只显示"操作失败"）
- **MUST**: 主页必须支持一键跳转到预约/课程/钱包（混合型设计）
- **SHOULD**: 学员切换时显示当前选中学员的头像和姓名
- **SHOULD**: 候补成功通知使用微信服务号模板消息推送

**合规检查**：
- Spec阶段必须包含用户操作流程图
- UI设计必须标注"防误操作"的交互细节

---

### Principle 7: Test-Driven Data Operations（测试驱动的数据操作）

**原则声明**：
- 涉及金额、库存的关键业务逻辑必须先写测试用例
- 数据操作必须可回滚和可审计

**具体要求**：
- **MUST**: 钱包扣款/充值操作必须有单元测试覆盖
- **MUST**: 课程库存锁定逻辑必须有并发测试（模拟多人同时预约）
- **MUST**: 所有数据库迁移脚本必须有回滚脚本
- **SHOULD**: 关键API端点必须有端到端自动化测试
- **MUST**: 测试数据与生产数据严格隔离

**合规检查**：
- Tasks阶段必须包含"编写测试用例"任务（在实现代码前）
- 每个数据库变更必须经过测试环境验证

---

### Principle 8: Security & Compliance（安全与合规 - 极简实用版）

**核心原则**：
- 信任微信登录和微信支付的安全机制
- 重点防护后端API的基本权限控制
- **以运营效率为优先**，避免过度设计

---

#### 一、小程序端（3条必须做的）

**1. 用户数据隔离**
- API必须验证：学员、钱包、订单数据属于当前登录用户
- 实现方式：FastAPI的`Depends(get_current_user)`自动注入当前用户
- 示例代码：
  ```python
  @app.get("/api/v1/students/{student_id}")
  def get_student(student_id: int, current_user: User = Depends(get_current_user)):
      student = db.query(Student).filter(Student.id == student_id).first()
      if student.parent_user_id != current_user.id:
          raise HTTPException(403, "无权访问该学员信息")
      return student
  ```

**2. 微信支付集成**
- 使用微信官方SDK（`wechatpayv3`）
- 在回调接口调用SDK的签名验证方法
- 检查订单是否已处理（防止重复回调）
- 示例代码：
  ```python
  from wechatpayv3 import WeChatPay

  @app.post("/api/v1/payments/callback")
  def payment_callback(request: Request):
      # SDK自动验证签名
      result = wechatpay.callback(request.headers, request.body)
      if result:
          # 检查订单是否已处理
          if not order_already_processed(result["out_trade_no"]):
              update_order_status(result["out_trade_no"], "paid")
      return {"code": "SUCCESS"}
  ```

**3. JWT Token过期时间**
- 设置7天过期（平衡安全性和用户体验）
- Token存储在小程序storage（微信环境已加密）

---

#### 二、Web后台端（4条必须做的）

**1. 管理员登录**
- 用户名+密码登录（不使用微信）
- 密码使用bcrypt加密存储

**2. 角色权限控制（RBAC）**
- **管理员**：全部权限
- **运营人员**：查看学员/课程/钱包，手动充值
- **教练**：只看自己负责的课程和学员
- **财务**：查看钱包/交易记录，导出报表

**3. 数据直接显示（无需脱敏）**
- 学员姓名、手机号、钱包余额**直接显示**
- 提升运营效率，加快处理速度

**4. 敏感操作审计日志**
- 充值、退款、删除学员操作记录日志
- 日志包含：操作人、时间、操作内容
- 表结构示例：
  ```sql
  CREATE TABLE audit_log (
    id INT PRIMARY KEY AUTO_INCREMENT,
    admin_id INT NOT NULL,
    action VARCHAR(50) NOT NULL,  -- 'recharge', 'refund', 'delete_student'
    details JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```

---

#### 三、基础设施（3条必须做的）

**1. HTTPS**
- 生产环境启用SSL证书

**2. 环境变量**
- 数据库密码、微信AppSecret、支付密钥存储在环境变量
- 不在代码中硬编码
- 示例（`.env`文件）：
  ```
  DATABASE_URL=mysql://user:password@localhost/db
  WECHAT_APP_SECRET=xxxxx
  WECHAT_PAY_KEY=xxxxx
  ```

**3. 数据库备份**
- 每日增量备份（防止数据丢失）
- 建议使用自动化脚本

---

#### 四、不需要做的（避免过度设计）

❌ 小程序端数据脱敏（家长看自己孩子信息，无需脱敏）  
❌ 后台数据脱敏（运营需要快速查看，直接显示）  
❌ 复杂的二次验证（无大额金融操作）  
❌ 手机号验证码登录（微信登录已足够）  
❌ 私域充值的回调验证（人工录入，无回调风险）  
❌ IP白名单（小团队维护成本高）  

---

**安全自查清单（只需5条）**：
- [ ] API是否验证用户只能访问自己的数据？
- [ ] 微信支付回调是否使用了官方SDK验证？
- [ ] 后台管理员密码是否加密存储？
- [ ] 后台是否实现了RBAC角色权限？
- [ ] 生产环境是否启用了HTTPS？

---

### Principle 9: Migration & Integration Support（迁移与集成支持）

**原则声明**：
- 支持从飞书多维表格平滑迁移数据
- 预留与飞书双向同步的能力

**具体要求**：
- **MUST**: 提供飞书数据导入工具（Excel/CSV格式）
- **MUST**: 数据导入前必须校验格式和必填字段
- **MUST**: 导入失败时提供详细错误报告（哪一行哪个字段有问题）
- **SHOULD**: 后台支持批量数据导出功能
- **SHOULD**: 预留飞书开放平台Webhook接口，支持未来自动同步

**合规检查**：
- MVP-1 必须包含"数据导入工具"的Spec和实现
- 导入逻辑必须有完整的异常处理

---

## 治理与合规 (Governance)

### 宪法修订流程
1. 任何原则的修改必须在此文档顶部添加修订记录（Sync Impact Report）
2. 版本号遵循语义化版本控制（Semantic Versioning）
3. 修订后必须同步更新依赖的模板文件（spec-template、plan-template、tasks-template）

### 合规审查
- **Spec阶段**：检查需求是否符合Principle 6（用户中心）和Principle 5（阶段划分）
- **Plan阶段**：检查技术方案是否符合Principle 1（简化）、Principle 2（数据完整性）、Principle 4（API架构）
- **Tasks阶段**：检查任务是否包含Principle 7（测试驱动）的测试任务
- **Implement阶段**：检查代码是否符合Principle 3（可读性）和Principle 8（安全）

### 例外情况处理
如果特定场景需要暂时偏离某项原则，必须：
1. 在Spec或Plan中显式说明原因
2. 标注`[CONSTITUTION_EXCEPTION: Principle X]`
3. 在后续迭代中评估是否修复

---

## 附录A：关键业务规则速查表

| 业务场景 | 规则 | 对应原则 |
|---------|------|---------|
| 学员切换 | 单微信ID绑定多学员，切换时强提醒当前学员 | Principle 6 |
| 钱包共享 | 家庭账号下所有学员共享钱包余额（允许负数） | Principle 2 |
| 排课优先级 | 长期约课 > 临时约课，先到先得 | Principle 2 |
| 课程满员 | 提供候补机制,有空位时微信推送 | Principle 6 |
| 体验课支付 | 固定200元，立即支付，无订单超时，支付失败立即释放名额 | Principle 5 |
| 重复预约限制 | 每个微信OpenID只能预约一次体验课 | Principle 5 |
| 正式课扣费 | 预约时立即扣费200元，允许欠费，取消预约时恢复余额 | Principle 2 |
| 欠费管理 | 欠费用户限制新预约，支持余额预警（<200元）和催缴通知 | Principle 4 |
| 运营调整 | 钱包调整需填写完整信息（原因、收款方式、订单号等） | Principle 8 |
| 体验课跟进 | 自动标记"待跟进"用户，支持转化率统计 | Principle 5 |
| 数据迁移 | 支持从飞书Excel导入，带校验和错误报告 | Principle 9 |
| 数据展示 | 学员信息、钱包余额直接显示（无需脱敏） | Principle 8 |

---

## 附录B：MVP优先级矩阵

| MVP | 核心价值 | 技术风险 | 开发周期 | 优先级 | 依赖关系 |
|-----|---------|---------|---------|--------|---------|
| MVP-1 | ⭐⭐⭐⭐⭐ | 低 | 1-2周 | P0 | 无 |
| MVP-2A | ⭐⭐⭐⭐⭐ | 中 | 2-3周 | P0 | 依赖MVP-1 |
| MVP-2B | ⭐⭐⭐⭐ | 中 | 1-2周 | P1 | 依赖MVP-2A |
| MVP-2C | ⭐⭐⭐ | 中 | 1-2周 | P1 | 依赖MVP-2A |
| MVP-3 | ⭐⭐⭐⭐ | 低 | 1周 | P0 | 依赖MVP-2A（体验课立即支付） |
| MVP-4 | ⭐⭐⭐⭐ | 中 | 1周 | P1 | 依赖MVP-3（支持欠费和预警） |
| MVP-5 | ⭐⭐⭐ | 中 | 2-3周 | P1 | 依赖MVP-3/4（完整运营管理） |

**说明**：
- **P0**：必须完成（核心业务流程）
- **P1**：重要功能（提升用户体验和运营效率）
- **P2**：锦上添花（可延后）

**新架构优势**：
- **并行开发**：MVP-2B和MVP-2C可并行开发，都依赖MVP-2A
- **快速交付**：更小的MVP颗粒度，每个都能快速验证业务价值
- **风险降低**：复杂功能拆分为独立MVP，降低单次开发风险

---

## 附录C：技术栈版本清单

| 层级 | 技术 | 版本 | 安装命令 | 备注 |
|------|------|------|---------|------|
| 小程序 | 微信开发者工具 | 最新稳定版 | 官网下载 | 基础库 3.11.0+ |
| 后端 | Python | 3.11+ | `python --version` | - |
| 后端框架 | FastAPI | 0.100+ | `pip install fastapi` | - |
| 数据库 | MySQL | 8.0+ | 官网下载 | - |
| ORM | SQLAlchemy | 2.x | `pip install sqlalchemy` | - |
| 支付SDK | wechatpayv3 | 最新 | `pip install wechatpayv3` | 官方Python SDK |
| 前端框架 | Vue | 3.x | `npm install vue@next` | - |
| UI组件库 | Element Plus | 最新 | `npm install element-plus` | - |

---

**本宪法自2025年10月25日17:40起生效，版本号v2.3.0。**

**所有后续开发活动必须遵循本宪法的九大核心原则。**
