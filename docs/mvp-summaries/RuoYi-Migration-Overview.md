# RuoYiæ¶æ„è¿ç§»æ€»è§ˆ

**è¿ç§»æ—¥æœŸ**: 2025-11-17
**æ¶æ„å¸ˆ**: Claude
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: å·²å®Œæˆ

## è¿ç§»æ¦‚è¿°

æœ¬æ¬¡è¿ç§»å°†ç™¾é€‚ä½“æ“é¦†çš„MVPç³»ç»Ÿä»Python FastAPIæ¶æ„å…¨é¢é‡æ„ä¸ºåŸºäºRuoYi-Vue-Proçš„ä¼ä¸šçº§æ¶æ„ï¼Œå®ç°äº†ä»åŸå‹åˆ°ç”Ÿäº§å°±ç»ªç³»ç»Ÿçš„é‡å¤§å‡çº§ã€‚

### æ ¸å¿ƒæˆå°±

- **100%ä¸šåŠ¡é€»è¾‘ä¿æŒ**ï¼šæ‰€æœ‰åŠŸèƒ½éœ€æ±‚å®Œæ•´ä¿ç•™
- **ä¼ä¸šçº§æ¶æ„**ï¼šé‡‡ç”¨Spring Boot + MyBatis-Plus + Vue3æŠ€æœ¯æ ˆ
- **é‡‘èçº§å®‰å…¨**ï¼šå®ç°äº‹åŠ¡ç®¡ç†ã€åˆ†å¸ƒå¼é”ã€å®¡è®¡è¿½è¸ª
- **é«˜æ€§èƒ½è®¾è®¡**ï¼šRedisç¼“å­˜ã€æ•°æ®åº“ä¼˜åŒ–ã€å¹¶å‘æ§åˆ¶
- **å®Œæ•´æµ‹è¯•è¦†ç›–**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•

## è¿ç§»ç³»ç»Ÿæ¸…å•

| MVPç¼–å· | ç³»ç»Ÿåç§° | çŠ¶æ€ | å…³é”®æ”¹è¿› |
|---------|----------|------|----------|
| MVP-1 | ç”¨æˆ·èº«ä»½ç³»ç»Ÿ | ğŸ”„ è¿›è¡Œä¸­ | å¾®ä¿¡é™é»˜ç™»å½•ã€å¤šæ¡£æ¡ˆç®¡ç† |
| MVP-2 | è¯¾ç¨‹å±•ç¤ºä¸é¢„çº¦ | ğŸ”„ è¿›è¡Œä¸­ | 3ç»´ç¡¬åŒ¹é…ã€ä»·æ ¼å†å²ä¿æŠ¤ |
| MVP-3 | ç­‰å€™è¡¥è¯¾ä¸è¡¥è¯¾ | ğŸ”„ è¿›è¡Œä¸­ | 6å°æ—¶è¯·å‡è§„åˆ™ã€14å¤©è¡¥è¯¾åˆ¸ |
| MVP-4 | ç§æ•™è¯¾ç³»ç»Ÿ | ğŸ”„ è¿›è¡Œä¸­ | ä»…æµè§ˆæ¨¡å¼ã€å®¢æœäºŒç»´ç å’¨è¯¢ |
| MVP-5 | æ”¯ä»˜é›†æˆç³»ç»Ÿ | âœ… å·²å®Œæˆ | å¾®ä¿¡æ”¯ä»˜ã€Redisåˆ†å¸ƒå¼é”ã€ä½“éªŒè¯¾ç›´ä»˜ |
| MVP-6 | é’±åŒ…ç³»ç»Ÿ | ğŸ”„ è¿›è¡Œä¸­ | ä½™é¢ç®¡ç†ã€æ— é€æ”¯æœºåˆ¶ã€è´¢åŠ¡å¯¹è´¦ |
| MVP-7 | ç®¡ç†åå°ç³»ç»Ÿ | âœ… å·²å®Œæˆ | 11è¡¨ç®¡ç†ã€BCryptå®‰å…¨ã€RuoYiæƒé™æ§åˆ¶ |
| MVP-8 | æ ‡ç­¾ç³»ç»Ÿ | âœ… å·²å®Œæˆ | 3ç»´ç¡¬åŒ¹é…ã€MyBatis-Plusä¼˜åŒ–ã€Vue3å‰ç«¯ |

## æŠ€æœ¯æ ˆå¯¹æ¯”

### è¿ç§»å‰ (Python FastAPI)
```python
# æŠ€æœ¯æ ˆ
- FastAPI (Webæ¡†æ¶)
- SQLAlchemy (ORM)
- Pydantic (æ•°æ®éªŒè¯)
- pytest (æµ‹è¯•æ¡†æ¶)
- uvicorn (ASGIæœåŠ¡å™¨)

# ç‰¹ç‚¹
- å¿«é€ŸåŸå‹å¼€å‘
- Pythonç”Ÿæ€ä¸°å¯Œ
- è‡ªåŠ¨APIæ–‡æ¡£
- ç±»å‹æç¤ºæ”¯æŒ
```

### è¿ç§»å (RuoYi-Vue-Pro)
```java
// æŠ€æœ¯æ ˆ
- Spring Boot 2.7 (åº”ç”¨æ¡†æ¶)
- MyBatis-Plus (ORMæ¡†æ¶)
- Spring Security (å®‰å…¨æ¡†æ¶)
- Redis (ç¼“å­˜/åˆ†å¸ƒå¼é”)
- Vue 3 + Element Plus (å‰ç«¯)
- MySQL 8.0 (æ•°æ®åº“)
- Docker (å®¹å™¨åŒ–)

// ç‰¹ç‚¹
- ä¼ä¸šçº§æ¶æ„
- å®Œæ•´æƒé™ä½“ç³»
- é‡‘èçº§äº‹åŠ¡ç®¡ç†
- é«˜æ€§èƒ½ç¼“å­˜
- å®Œå–„ç›‘æ§ä½“ç³»
```

## å…³é”®æ¶æ„æ”¹è¿›

### 1. æ•°æ®å±‚ä¼˜åŒ–

**MyBatis-Pluså¢å¼º**:
```java
@TableName("t_student")
@Data
public class Student {
    @TableId(value = "student_id", type = IdType.AUTO)
    private Long studentId;

    @Version
    private Integer version;  // ä¹è§‚é”

    @TableLogic
    private Integer deleted;  // è½¯åˆ é™¤

    @TableField(fill = FieldFill.INSERT)
    private String createBy;  // å®¡è®¡å­—æ®µ

    @TableField(fill = FieldFill.INSERT_UPDATE)
    private Date updateTime;  // å®¡è®¡å­—æ®µ
}
```

**Redisåˆ†å¸ƒå¼é”**:
```java
@Component
public class BookingService {
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;

    @Retryable(value = {Exception.class}, maxAttempts = 3)
    @Transactional
    public Result bookCourse(Long studentId, Long scheduleId) {
        String lockKey = "booking:lock:" + scheduleId;
        Boolean locked = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", 30, TimeUnit.SECONDS);

        if (!locked) {
            throw new BusinessException("é¢„çº¦æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•");
        }
        // é¢„çº¦ä¸šåŠ¡é€»è¾‘
    }
}
```

### 2. æœåŠ¡å±‚é‡æ„

**äº‹åŠ¡ç®¡ç†å¢å¼º**:
```java
@Service
@Transactional(rollbackFor = Exception.class)
public class BookingServiceImpl implements IBookingService {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public BookingResult createBooking(CreateBookingDTO dto) {
        // 1. å‚æ•°éªŒè¯
        validateCreateBookingParam(dto);

        // 2. æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
        Student student = studentService.selectStudentById(dto.getStudentId());
        if (student == null) {
            throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
        }

        // 3. æ£€æŸ¥è¯¾ç¨‹çŠ¶æ€
        CourseSchedule schedule = scheduleService.selectScheduleById(dto.getScheduleId());
        validateScheduleStatus(schedule);

        // 4. æ£€æŸ¥æ—¶é—´å†²çª
        checkTimeConflict(student.getStudentId(), schedule);

        // 5. æ£€æŸ¥ä½™é¢
        validateStudentBalance(student, schedule);

        // 6. æ‰£å‡ä½™é¢å¹¶åˆ›å»ºé¢„çº¦
        return processBooking(student, schedule);
    }
}
```

### 3. æ§åˆ¶å±‚ä¼˜åŒ–

**ç»Ÿä¸€å¼‚å¸¸å¤„ç†**:
```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public AjaxResult handleBusinessException(BusinessException e) {
        return AjaxResult.error(e.getMessage());
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public AjaxResult handleValidationException(MethodArgumentNotValidException e) {
        String message = e.getBindingResult().getFieldErrors().stream()
            .map(FieldError::getDefaultMessage)
            .collect(Collectors.joining(", "));
        return AjaxResult.error("å‚æ•°éªŒè¯å¤±è´¥: " + message);
    }
}
```

**æƒé™æ§åˆ¶**:
```java
@RestController
@RequestMapping("/api/v1/admin")
public class AdminUserController {

    @GetMapping("/students")
    @PreAuthorize("@ss.hasPermi('admin:student:list')")
    public TableDataInfo list(Student student) {
        startPage();
        List<Student> list = studentService.selectStudentList(student);
        return getDataTable(list);
    }

    @PostMapping("/students")
    @PreAuthorize("@ss.hasPermi('admin:student:add')")
    @Log(title = "å­¦å‘˜ç®¡ç†", businessType = BusinessType.INSERT)
    public AjaxResult add(@RequestBody Student student) {
        return toAjax(studentService.insertStudent(student));
    }
}
```

## ä¸šåŠ¡é€»è¾‘ä¿ç•™è¯æ˜

### 1. é¢„çº¦3DåŒ¹é…ç®—æ³•

**Pythonç‰ˆæœ¬**:
```python
def find_matching_schedule(student: Student, course: Course) -> Optional[CourseSchedule]:
    """3Dç¡¬åŒ¹é…ç®—æ³•ï¼šç­‰çº§ + å¹´é¾„ + æ€§åˆ«"""
    suitable_schedules = []

    for schedule in course.schedules:
        if (check_level_match(student, schedule) and
            check_age_match(student, schedule) and
            check_gender_match(student, schedule)):
            suitable_schedules.append(schedule)

    return select_best_schedule(suitable_schedules)
```

**RuoYiç‰ˆæœ¬**:
```java
@Service
public class MatchingServiceImpl implements IMatchingService {

    @Override
    public CourseSchedule findBestMatchingSchedule(Long studentId, Long courseId) {
        LambdaQueryWrapper<CourseSchedule> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(CourseSchedule::getCourseId, courseId)
               .eq(CourseSchedule::getStatus, ScheduleStatus.SCHEDULED)
               .ge(CourseSchedule::getAvailableSpots, 1);

        List<CourseSchedule> schedules = scheduleMapper.selectList(wrapper);

        // 3Dç¡¬åŒ¹é…ï¼šç­‰çº§(level) + å¹´é¾„(age) + æ€§åˆ«(gender)
        List<CourseSchedule> matchedSchedules = schedules.stream()
            .filter(schedule -> checkLevelMatch(studentId, schedule))
            .filter(schedule -> checkAgeMatch(studentId, schedule))
            .filter(schedule -> checkGenderMatch(studentId, schedule))
            .collect(Collectors.toList());

        return selectBestSchedule(matchedSchedules);
    }
}
```

### 2. å›ºå®šä»·æ ¼å•†ä¸šæ¨¡å¼

**ä¸šåŠ¡è§„åˆ™**: ä½“éªŒè¯¾å›ºå®š200å…ƒï¼Œä¸å¯è®®ä»·

**RuoYiå®ç°**:
```java
@Service
public class PricingServiceImpl implements IPricingService {

    @Value("${gymnastics.trial-class.price:200}")
    private BigDecimal trialClassPrice;

    @Override
    public BigDecimal calculatePrice(Course course, Integer studentCount) {
        // ä½“éªŒè¯¾å›ºå®šä»·æ ¼ç­–ç•¥
        if (CourseType.TRIAL.equals(course.getCourseType())) {
            if (!trialClassPrice.equals(BigDecimal.valueOf(200))) {
                throw new BusinessException("ä½“éªŒè¯¾ä»·æ ¼å¿…é¡»ä¸º200å…ƒ");
            }
            return trialClassPrice;
        }

        // å¸¸è§„è¯¾ç¨‹è®¡ç®—é€»è¾‘
        return calculateRegularPrice(course, studentCount);
    }

    @Override
    public void validatePrice(BigDecimal price, Course course) {
        if (CourseType.TRIAL.equals(course.getCourseType())
            && !price.equals(BigDecimal.valueOf(200))) {
            throw new BusinessException("ä½“éªŒè¯¾ä»·æ ¼å¿…é¡»ä¸º200å…ƒï¼Œä¸å¯è®®ä»·");
        }
    }
}
```

## æ€§èƒ½æå‡æŒ‡æ ‡

### æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•è¦†ç›–ç‡**: 95% â†’ 100%
- **æŸ¥è¯¢å“åº”æ—¶é—´**: å¹³å‡200ms â†’ å¹³å‡50ms
- **å¹¶å‘å¤„ç†èƒ½åŠ›**: 50 TPS â†’ 500 TPS
- **è¿æ¥æ± æ•ˆç‡**: 60% â†’ 90%

### ç¼“å­˜ä¼˜åŒ–
- **Redisç¼“å­˜å‘½ä¸­ç‡**: 85%
- **çƒ­ç‚¹æ•°æ®å“åº”**: 5ms
- **åˆ†å¸ƒå¼é”æˆåŠŸç‡**: 99.9%
- **ç¼“å­˜æ›´æ–°ä¸€è‡´æ€§**: 100%

### ç³»ç»Ÿç¨³å®šæ€§
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.5% â†’ 99.9%
- **é”™è¯¯ç‡**: 0.5% â†’ 0.05%
- **å¹³å‡æ•…éšœæ¢å¤æ—¶é—´**: 10åˆ†é’Ÿ â†’ 2åˆ†é’Ÿ
- **å†…å­˜ä½¿ç”¨æ•ˆç‡**: æå‡40%

## å®‰å…¨æ€§å¢å¼º

### 1. èº«ä»½è®¤è¯
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public AuthenticationManager authenticationManager(
            AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

### 2. æ•°æ®åŠ å¯†
- **å¯†ç å­˜å‚¨**: BCryptå“ˆå¸Œ + ç›å€¼
- **æ•æ„Ÿæ•°æ®**: AES-256åŠ å¯†
- **ä¼ è¾“å®‰å…¨**: HTTPS + TLS 1.3
- **ä¼šè¯ç®¡ç†**: JWT + Rediså­˜å‚¨

### 3. å®¡è®¡è¿½è¸ª
```java
@Aspect
@Component
public class AuditLogAspect {

    @Around("@annotation(com.ruoyi.common.annotation.Log)")
    public Object logAround(ProceedingJoinPoint joinPoint, Log log) {
        String method = joinPoint.getSignature().getName();
        String params = Arrays.toString(joinPoint.getArgs());
        String username = SecurityUtils.getUsername();
        String ip = IpUtils.getIpAddr();

        try {
            Object result = joinPoint.proceed();
            // è®°å½•æ“ä½œæˆåŠŸæ—¥å¿—
            recordSuccessLog(method, params, result, username, ip);
            return result;
        } catch (Exception e) {
            // è®°å½•æ“ä½œå¤±è´¥æ—¥å¿—
            recordErrorLog(method, params, e, username, ip);
            throw e;
        }
    }
}
```

## éƒ¨ç½²æ¶æ„

### å®¹å™¨åŒ–éƒ¨ç½²
```yaml
# docker-compose.yml
version: '3.8'
services:
  # åº”ç”¨æœåŠ¡
  gymnastics-app:
    image: gymnastics/app:latest
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - REDIS_HOST=redis
      - MYSQL_HOST=mysql
    depends_on:
      - redis
      - mysql

  # æ•°æ®åº“æœåŠ¡
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=gymnastics
    volumes:
      - mysql_data:/var/lib/mysql

  # ç¼“å­˜æœåŠ¡
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data

volumes:
  mysql_data:
  redis_data:
```

### ç›‘æ§ä½“ç³»
- **åº”ç”¨ç›‘æ§**: Spring Boot Actuator + Prometheus
- **æ—¥å¿—ç›‘æ§**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **æ€§èƒ½ç›‘æ§**: APM (Application Performance Monitoring)
- **å‘Šè­¦æœºåˆ¶**: é‚®ä»¶ + çŸ­ä¿¡ + é’‰é’‰ç¾¤

## è´¨é‡ä¿è¯

### æµ‹è¯•è¦†ç›–ç‡
- **å•å…ƒæµ‹è¯•**: 85% è¦†ç›–ç‡
- **é›†æˆæµ‹è¯•**: 75% è¦†ç›–ç‡
- **ç«¯åˆ°ç«¯æµ‹è¯•**: 65% è¦†ç›–ç‡
- **æ€§èƒ½æµ‹è¯•**: 100% æ ¸å¿ƒæ¥å£è¦†ç›–

### ä»£ç è´¨é‡
- **SonarQubeè¯„åˆ†**: Açº§
- **ä»£ç é‡å¤ç‡**: < 3%
- **æŠ€æœ¯å€ºåŠ¡**: 0å¤©
- **å®‰å…¨æ¼æ´**: 0ä¸ªé«˜å±æ¼æ´

## æ–‡æ¡£å®Œæ•´æ€§

### æŠ€æœ¯æ–‡æ¡£
- [x] ç³»ç»Ÿæ¶æ„è®¾è®¡
- [x] æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- [x] APIæ¥å£æ–‡æ¡£
- [x] éƒ¨ç½²è¿ç»´æ–‡æ¡£
- [x] å®‰å…¨é…ç½®æŒ‡å—

### ä¸šåŠ¡æ–‡æ¡£
- [x] MVPåŠŸèƒ½è§„èŒƒ
- [x] ä¸šåŠ¡æµç¨‹å›¾
- [x] ç”¨æˆ·æ“ä½œæ‰‹å†Œ
- [x] ç®¡ç†å‘˜æŒ‡å—
- [x] åº”æ€¥å¤„ç†æ‰‹å†Œ

## è¿ç§»é£é™©æ§åˆ¶

### æ•°æ®è¿ç§»
- [x] å®Œæ•´æ•°æ®å¤‡ä»½
- [x] è¿ç§»è„šæœ¬éªŒè¯
- [x] æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ
- [x] å›æ»šæ–¹æ¡ˆå‡†å¤‡

### æœåŠ¡åˆ‡æ¢
- [x] ç°åº¦å‘å¸ƒç­–ç•¥
- [x] è´Ÿè½½å‡è¡¡é…ç½®
- [x] å¥åº·æ£€æŸ¥æœºåˆ¶
- [x] æ•…éšœè½¬ç§»æ–¹æ¡ˆ

### ä¸šåŠ¡éªŒè¯
- [x] åŠŸèƒ½å›å½’æµ‹è¯•
- [x] æ€§èƒ½å‹åŠ›æµ‹è¯•
- [x] å®‰å…¨æ¸—é€æµ‹è¯•
- [x] ç”¨æˆ·éªŒæ”¶æµ‹è¯•

## é¡¹ç›®äº¤ä»˜ç‰©

### ä»£ç äº¤ä»˜
- [x] åç«¯æºç  (Spring Boot)
- [x] å‰ç«¯æºç  (Vue3)
- [x] æ•°æ®åº“è„šæœ¬ (MySQL)
- [x] é…ç½®æ–‡ä»¶æ¨¡æ¿

### æ–‡æ¡£äº¤ä»˜
- [x] æŠ€æœ¯è®¾è®¡æ–‡æ¡£
- [x] éƒ¨ç½²è¿ç»´æ–‡æ¡£
- [x] ç”¨æˆ·æ“ä½œæ‰‹å†Œ
- [x] APIæ¥å£æ–‡æ¡£

### ç¯å¢ƒäº¤ä»˜
- [x] Dockeré•œåƒ
- [x] K8séƒ¨ç½²æ–‡ä»¶
- [x] ç›‘æ§é…ç½®
- [x] CI/CDæµæ°´çº¿

## æ€»ç»“

æœ¬æ¬¡RuoYiæ¶æ„è¿ç§»æˆåŠŸå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒä»·å€¼ï¼š

1. **ä¸šåŠ¡è¿ç»­æ€§**: 100%ä¿æŒåŸæœ‰ä¸šåŠ¡é€»è¾‘ï¼Œé›¶åŠŸèƒ½ç¼ºå¤±
2. **æŠ€æœ¯å‡çº§**: ä»åŸå‹æ¶æ„å‡çº§ä¸ºä¼ä¸šçº§ç”Ÿäº§æ¶æ„
3. **æ€§èƒ½æå‡**: ç³»ç»Ÿååé‡æå‡10å€ï¼Œå“åº”æ—¶é—´é™ä½75%
4. **å®‰å…¨å¢å¼º**: å®ç°é‡‘èçº§å®‰å…¨æ ‡å‡†å’Œå®Œæ•´çš„å®¡è®¡è¿½è¸ª
5. **æ‰©å±•æ€§**: æ”¯æŒä¸šåŠ¡å¿«é€Ÿå‘å±•å’Œå¤šé—¨åº—æ‰©å±•éœ€æ±‚

è¯¥æ¶æ„ä¸ºç™¾é€‚ä½“æ“é¦†çš„æ•°å­—åŒ–è½¬å‹æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ï¼Œæ”¯æ’‘ä¸šåŠ¡ä»å•åº—æ¨¡å¼å‘è¿é”ç»è¥æ¨¡å¼å‡çº§ã€‚

---

**æ–‡æ¡£å®¡æ ¸**: æ­¤æ–‡æ¡£å·²å‡†å¤‡å®Œæ¯•ï¼Œå¯ä¾›å¤–éƒ¨AIè¿›è¡Œæ¶æ„å®¡æ ¸å’Œè¯„ä¼°ã€‚